<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bills and Payments</title>
  <link rel="icon" type="image/png" href="../assets/EduCare Logo.png" />
  <link rel="stylesheet" href="../BillsandPayments/BillsandPayment-style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
</head>

<body>
  <div class="info">
    <h1>Bills & <br> Payments</h1>
  </div>
  <div class="back">
    <a href="../Student-portal/Student-Portal.html">
      <i class="fas fa-arrow-left">back </i>
    </a>
  </div>

  <div class="coursesbody">
    <div class="navigator">
      <button onclick="goPrevious()">Previous</button>
      <span id="display">Year 1 - Semester 1</span>
      <button onclick="goNext()">Next</button>
    </div>
    <div id="bill-area"></div>

  </div>
  <script>
    const API_BASE = "https://educare-students-hub-eadz.onrender.com";
    
    const years = ["Year 1", "Year 2"];
    const semesters = ["Semester 1 and 2"];
    let currentYearIndex = 0;
    let currentSemesterIndex = 0;
    let forceNoData = false;

    async function updateDisplay() {
      const display = document.getElementById("display");
      const billArea = document.getElementById("bill-area");
      const year = years[currentYearIndex];
      const semester = semesters[currentSemesterIndex];

      display.textContent = `${year} - ${semester}`;

      if (forceNoData) {
        billArea.innerHTML = `
        <div class="payment-container">
          <p style="text-align:center; font-size:18px; font-weight:bold; color:#999;">
            No billing data available for Year 2 semester 1 and 2.
          </p>
        </div>
      `;
        forceNoData = false; 
        return;
      }

      try {
        const studentId = localStorage.getItem("studentId");
        const res = await fetch(`${API_BASE}/student-bills/${studentId}`);
        const data = await res.json();

        if (data.items) {
          billArea.innerHTML = `
          <div class="payment-container">
            <div class="payment-statement"><h5>Total amount you owe:</h5></div>
            <div class="bill">GHS ${data.total.toFixed(2)}</div>
          </div>
          ${data.items.map(item => `
            <div class="payment-container1">
              <div class="payment-statement"><h5>${item.label}:</h5></div>
              <div style="color:${item.status === 'owing' ? 'red' : '#0078d4'}" class="bill">
                GHS ${item.amount.toFixed(2)}
              </div>
            </div>
          `).join("")}
          <div class="payment-link">
            <a href="#">CLICK HERE TO PAY YOUR BILLS</a>
          </div>
        `;
        } else {
          billArea.innerHTML = `
          <div class="payment-container">
            <p style="text-align:center; font-size:18px; font-weight:bold; color:#999;">
              No billing data available for ${year} ${semester}.
            </p>
          </div>
        `;
        }
      } catch (err) {
        console.error("âŒ Failed to load bills:", err);
      }
    }

    function goNext() {
      currentSemesterIndex++;
      if (currentSemesterIndex >= semesters.length) {
        currentSemesterIndex = 0;
        currentYearIndex++;
        if (currentYearIndex >= years.length) {
          currentYearIndex = 0;
        }
      }
      forceNoData = true; 
      updateDisplay();
    }

    function goPrevious() {
      currentSemesterIndex--;
      if (currentSemesterIndex < 0) {
        currentSemesterIndex = semesters.length - 1;
        currentYearIndex--;
        if (currentYearIndex < 0) {
          currentYearIndex = years.length - 1;
        }
      }
      updateDisplay();
    }

    window.onload = updateDisplay;
  </script>
</body>

</html>
